
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Forklift G√∂revleri</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f4f6f8;
    }
    .page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .page-header h2 {
      font-size: 24px;
      color: #2f3840;
    }
    .action-bar {
      display: flex;
      gap: 10px;
    }
    .action-bar button {
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      background-color: #3f7dcf;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }
    .action-bar button:hover {
      background-color: #345fa7;
    }
    .content {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 2px;
      margin-top: 10px;
    }
    thead th {
      background-color: #d299e4;
      color: white;
      font-weight: 600;
      padding: 12px 16px;
      text-align: center;
      font-size: 14px;
    }
    
    tbody td {
      padding: 12px 16px;
      border-bottom: 1px solid #e0e0e0;
      font-size: 14px;
      color: #333;
      text-align: center;
    }
    tbody tr:hover {
      background-color: #f9fbff;
    }
    tbody tr:last-child td {
      border-bottom: none;
    }
    th.sortable {
     cursor: pointer;
    }
  
.priority-badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 13px;
  font-weight: 600;
  color: white;
  text-transform: uppercase;
}

.priority-high {
  background-color: #e74c3c;
}

.priority-medium {
  background-color: #f1c40f;
  color: #2f3840;
}

.priority-low {
  background-color: #2ecc71;
}

.priority-unknown {
  background-color: #393b3a;
}

/* Kart tipi g√∂r√ºn√ºm i√ßin tablonun satƒ±rlarƒ±nƒ± kutu gibi g√∂ster */
tbody tr {
  background-color: #fff;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  border-radius: 8px;
  margin-bottom: 8px;
  display: table-row;
  transition: all 0.2s ease-in-out;
}

tbody tr:hover {
  background-color: #f1f6ff;
  transform: scale(1.01);
}

tbody td {
  border-bottom: none;
}

</style>
</head>
<body>
  <div class="page-header">
    <h2>üìã Forklift G√∂revleri</h2>
    <div class="action-bar">
      <button onclick="openModal()">+ Yeni G√∂rev</button>
      <button>Rapor Al</button>
    </div>
  </div>

  <div class="content">
    <table id="taskTable">
      <thead>
        <tr>
          <th class="sortable" onclick="sortById(this)"># G√∂rev ID <span id="idArrow">‚ñº</span></th>
          <th>G√∂rev Adƒ± / A√ßƒ±klamasƒ±</th>
          <th>Durum</th>
          <th class="sortable" onclick="sortByPriority(this)">‚è≥ √ñncelik <span id="priorityArrow">‚ñº</span></th>
          <th>üì¶ Kaynak Lokasyon (FROM)</th>
          <th>üéØ Hedef Lokasyon (TO)</th>
          <th> Operator</th>
          <th> Olusturulma Tarihi / Saati</th>
          

        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Modal -->
  <div class="modal" id="taskModal" style="display: none; position: fixed; top: 0; left: 0; 
    width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="background: white; width: 400px; margin: 10% auto; padding: 20px; border-radius: 8px;">
      <span style="float:right; cursor:pointer;" onclick="closeModal()">√ó</span>
      <h3>Yeni G√∂rev Ekle</h3>
      <label>G√∂rev ID</label>
      <input type="text" id="taskId" style="width:100%; padding:6px;">
      <label>Kaynak Lokasyon</label>
      <input type="text" id="taskSource" style="width:100%; padding:6px;">
      <label>Hedef Lokasyon</label>
      <input type="text" id="taskDestination" style="width:100%; padding:6px;">
      <label>√ñncelik</label>
      <select id="taskPriority" style="width:100%; padding:6px;">
        <option value="Y√ºksek">Y√ºksek</option>
        <option value="Orta">Orta</option>
        <option value="D√º≈ü√ºk">D√º≈ü√ºk</option>
      </select>
      <button onclick="addTask()" style="margin-top:10px; background:#3f7dcf; color:white; padding:8px 12px; border:none; border-radius:4px; cursor:pointer;">G√∂revi Ekle</button>
    </div>
  </div>

  <script>
    let allTasks = [];

function renderTable(tasks) {
  const tbody = document.querySelector('#taskTable tbody');
  tbody.innerHTML = '';

  if (tasks.length === 0) {
    tbody.innerHTML = '<tr><td colspan="8">G√∂rev bulunamadƒ±.</td></tr>';
    return;
  }

  tasks.forEach(task => {
    
    //let rawPriority = (task.priority || "").toString();
    const p = parseInt(task.priority);
    let badgeClass = 'priority-unknown';
    let priorityText = "Bilinmiyor";

    if (p == 1) {
      badgeClass = 'priority-high';
      priorityText = "Y√ºksek";
    } else if (p == 2) {
      badgeClass = 'priority-medium';
      priorityText = "Orta";
    } else if (p == 3) {
      badgeClass = 'priority-low';
      priorityText = "D√º≈ü√ºk";
    }



  
    const row = `
      <tr>
        <td>${task.id}</td>
        <td>${task.description}</td>
        <td>${task.status}</td>
        <td><span class="priority-badge ${badgeClass}">${priorityText}</span></td>
        <td>${task.location_from}</td>
        <td>${task.location_to}</td>
        <td>${task.assigned_to || "‚Äî"}</td>
        <td>${new Date(task.created_at).toLocaleString('tr-TR')}</td>
      </tr>
    `;
    tbody.insertAdjacentHTML('beforeend', row);
  });
}



    function openModal() {
      document.getElementById('taskModal').style.display = 'block';
    }

    function closeModal() {
      document.getElementById('taskModal').style.display = 'none';
      document.getElementById('taskId').value = '';
      document.getElementById('taskSource').value = '';
      document.getElementById('taskDestination').value = '';
    }

    function addTask() {
      const id = document.getElementById('taskId').value.trim();
      const source = document.getElementById('taskSource').value.trim();
      const destination = document.getElementById('taskDestination').value.trim();
      const priority = document.getElementById('taskPriority').value;

      if (!id || !source || !destination) {
        alert("L√ºtfen t√ºm alanlarƒ± doldurun.");
        return;
      }

      allTasks.push({ id, source, destination, priority });
      renderTable(allTasks);
      closeModal();
    }

let prioritySortAsc = true;

function sortByPriority(header) {
 const arrow = document.getElementById('priorityArrow');
  arrow.textContent = prioritySortAsc ? '‚ñ≤' : '‚ñº';
  const priorityOrder = {
    "y√ºksek": 3,
    "orta": 2,
    "d√º≈ü√ºk": 1
  };

  

  allTasks.sort((a, b) => {
    const pa = priorityOrder[(a.priority || "").toLowerCase()] || 0;
    const pb = priorityOrder[(b.priority || "").toLowerCase()] || 0;
    return prioritySortAsc ? pb - pa : pa - pb;
  });

  prioritySortAsc = !prioritySortAsc;
  renderTable(allTasks);
}

let idSortAsc = true;

function sortById(header) {
  const arrow = document.getElementById('idArrow');
  arrow.textContent = idSortAsc ? '‚ñ≤' : '‚ñº';

  allTasks.sort((a, b) => {
    const getParts = str => {
      const match = (str || '').match(/([a-zA-Z]+)-?(\d+)/);
      return match ? [match[1], parseInt(match[2])] : [str, 0];
    };
    const [prefixA, numA] = getParts(a.id);
    const [prefixB, numB] = getParts(b.id);

    if (prefixA === prefixB) {
      return idSortAsc ? numA - numB : numB - numA;
    }
    return idSortAsc ? prefixA.localeCompare(prefixB) : prefixB.localeCompare(prefixA);
  });

  idSortAsc = !idSortAsc;
  renderTable(allTasks);
}



/*
    fetch('../data/tasks.json')
      .then(res => res.json())
      .then(data => {
        allTasks = data;
        renderTable(allTasks);
      });
  */
// Yeni fetch
fetch("http://127.0.0.1:8000/api/tasks")
  .then(res => res.json())
  .then(data => {
    const tasks = data.tasks.map(task => {
      // Sayƒ±sal √∂nceliƒüi metne √ßevir

      const p = parseInt(task.priority);

      let priorityText = 
      p == 1 ? "Y√ºksek" :
      p == 2 ? "Orta" :
      p == 3 ? "D√º≈ü√ºk" :
      "Bilinmiyor";


      return {
        id: task.id,
        description: task.description,
        status: task.status,
        priority: priorityText,
        location_from: task.location_from,
        location_to: task.location_to,
        assigned_to: task.assigned_to || "‚Äî",
        created_at: task.created_at
      };
    });

    allTasks = tasks;
    renderTable(allTasks);
  })
  .catch(err => {
    console.error("API baƒülantƒ±sƒ± ba≈üarƒ±sƒ±z:", err);
  });

    </script>
</body>
</html>
